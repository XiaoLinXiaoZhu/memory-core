## 提升getSuggestions 的计算方式

### 当前状态

通过公式：
$$价值 = Sigmoid(权重) / 字符数$$
```ts
const sigmoidValue = 100 / (1 + Math.exp(-0.07 * weight + 1));
const value = characterCount > 0 ? sigmoidValue / characterCount : 0;
```

计算分析价值，并提供最小的 n 个低价值记忆片段。

### 优化目标
1. 价值的说法改为信息散度，作为记忆系统，需要保证信息的单元化和网络化，也就是说，我们更希望这样的结构：

通过链接将信息作为片段组织起来
```
[AAAA]
  ├── [A1]
  ├── [A2]
  ├── [A3]
  └── [A4]
```

而不是 将所有信息都作为内联片段集中到一个记忆片段中
```
[AAAA]
A1
A2
A3
A4
```

2. 需要额外提供其他的建议：维护和处理“孤立片段”，即没有链接到其他片段的记忆片段。

建议 模型 先分析孤立片段的内容和特征，然后进行下列操作之一：
a. 将其链接到其他相关片段
b. 将其和其他片段合并
c. 将其直接删除。


### 修改建议

#### memory-core中

1. 将 getSuggestions 方法弃用，
   - 新增 getLowValueSuggestions 方法，专注于获取低价值片段。
   - 新增 getIsolatedSuggestions 方法，专注于获取孤立片段。

2. 修改 getLowValueSuggestions 方法的计算逻辑：
   - 使用信息散度计算价值。
   - 返回低价值片段的列表。（系统片段除外，因为它是系统片段，有可能价值较低但是不适合删除或修改）

3. 修改 getIsolatedSuggestions 方法的计算逻辑：
    - 检查每个片段是否backLinks，如果没有backLinks，则认为是孤立片段（无法通过其他片段链接到它）（系统片段除外，因为它是系统片段，通常不会被链接到其他片段）。
    - 返回孤立片段的列表。
    - 尝试进行缓存处理，以提升性能（因为会对片段内容造成影响的只有：
      - setContent 方法
      - insertLinkAt 方法
      - rename 方法
      - extractContent 方法

4. 增加 判断系统片段功能
   - 增加 isSystemCard 方法，判断一个片段是否是系统片段（如 bootloader 片段），判断方法为检查片段开头是否包含 <!-- core memory -->。
   - 如果是系统片段，则不进行孤立片段的处理。
   - 如果是系统片段，则不进行低价值片段的处理。
   - 如果是系统片段，则不运行进行修改，提取，重命名，插入链接等操作。它为只读片段。

#### memory-core 完成后

1. 编写单元测试，确保新方法的正确性。注意单元测试需要放在 test 目录下。
2. 更新文档，说明新方法的使用方式和注意事项。
3. 提升 minor 版本号，并且 发布到 npm。
4. 更新 memory-server 的 package.json 中的 memory-core 版本号，确保使用最新的 core 版本。
5. 适用 npm install 更新 memory-server 的依赖为最新版本的 memory-core。

#### memory-server中

1. 修改 zettelkastenHandlers.ts 中的 getSuggestions 方法：
   - 使用新的 getLowValueSuggestions 方法获取低价值片段。（不需要创建新的mcp工具）
   - 使用新的 getIsolatedSuggestions 方法获取孤立片段。（不需要创建新的mcp工具）
   - 之后将低价值片段和孤立片段的建议合并到一个响应中。

2. 适配 系统片段功能
   - 在获取低价值片段和孤立片段时，因为 core 那边已经做了系统片段的判断，所以这里不需要再做判断。
   - 在 core 返回无法对系统片段进行修改的提示时，提示模型注意系统片段的只读特性，并建议在其他片段中进行修改。

3. 修改提示词描述，
   - 在提示词中增加对低价值片段和孤立片段的描述。
   - 取消 "价值" 的说法，改为 "信息散度"，因为价值容易引起误解。
   - 提示词中增加对系统片段的只读特性的说明。


#### memory-server 完成后

1. 编写单元测试，确保新方法的正确性。注意单元测试需要放在 test 目录下。
2. 更新文档，说明新方法的使用方式和注意事项。
3. 提升 minor 版本号，并且 发布到 npm。
4. 将最新版本的 memory-server 安装到全局，`npm install -g zettelkasten-memory-server`。